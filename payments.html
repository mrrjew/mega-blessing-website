<!doctype html>
<html lang="en" class="h-full bg-gray-50">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payments - Mega Blessing Chapel International</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <style>
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-overlay {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Connect Select visual style matches inputs */
        select {
            background-image: none !important;
            /* Ensure we use our custom chevron div */
        }
    </style>
</head>

<body class="h-full font-['Inter'] antialiased text-gray-900">

    <!-- Mobile Sidebar Dialog -->
    <el-dialog>
        <dialog id="sidebar" class="backdrop:bg-transparent lg:hidden">
            <el-dialog-backdrop
                class="fixed inset-0 bg-gray-900/80 transition-opacity duration-300 ease-linear data-closed:opacity-0"></el-dialog-backdrop>
            <div tabindex="0" class="fixed inset-0 flex focus:outline-none">
                <el-dialog-panel
                    class="group/dialog-panel relative mr-16 flex w-full max-w-xs flex-1 transform transition duration-300 ease-in-out data-closed:-translate-x-full">
                    <div
                        class="absolute top-0 left-full flex w-16 justify-center pt-5 duration-300 ease-in-out group-data-closed/dialog-panel:opacity-0">
                        <button type="button" command="close" commandfor="sidebar" class="-m-2.5 p-2.5">
                            <span class="sr-only">Close sidebar</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                                aria-hidden="true" class="size-6 text-white">
                                <path d="M6 18 18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>

                    <div class="relative flex grow flex-col gap-y-5 overflow-y-auto bg-white px-6 pb-4">
                        <div class="relative flex h-16 shrink-0 items-center">
                            <img src="church logo.png" alt="MBCI Logo" class="h-12 w-auto" />
                        </div>
                        <nav class="relative flex flex-1 flex-col">
                            <ul role="list" class="flex flex-1 flex-col gap-y-7">
                                <li>
                                    <ul role="list" class="-mx-2 space-y-1">
                                        <li>
                                            <a href="membership.html"
                                                class="group flex gap-x-3 rounded-md p-2 text-sm/6 font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="1.5"
                                                    class="size-6 shrink-0 text-gray-400 group-hover:text-indigo-600">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                                                </svg>
                                                Membership
                                            </a>
                                        </li>
                                        <li>
                                            <a href="payments.html"
                                                class="group flex gap-x-3 rounded-md bg-gray-50 p-2 text-sm/6 font-semibold text-indigo-600">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="1.5" class="size-6 shrink-0 text-indigo-600">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z" />
                                                </svg>
                                                Payments
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </el-dialog-panel>
            </div>
        </dialog>
    </el-dialog>

    <!-- Desktop Sidebar -->
    <div class="hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-64 lg:flex-col">
        <div class="flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-white px-6 pb-4">
            <div class="flex h-16 shrink-0 items-center">
                <img src="church logo.png" alt="MBCI Logo" class="h-12 w-auto" />
            </div>
            <nav class="flex flex-1 flex-col">
                <ul role="list" class="flex flex-1 flex-col gap-y-7">
                    <li>
                        <ul role="list" class="-mx-2 space-y-1">
                            <li>
                                <a href="membership.html"
                                    class="group flex gap-x-3 rounded-md p-2 text-sm/6 font-semibold text-gray-700 hover:bg-gray-50 hover:text-indigo-600">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                                        class="size-6 shrink-0 text-gray-400 group-hover:text-indigo-600">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                                    </svg>
                                    Membership
                                </a>
                            </li>
                            <li>
                                <a href="payments.html"
                                    class="group flex gap-x-3 rounded-md bg-gray-50 p-2 text-sm/6 font-semibold text-indigo-600">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                                        class="size-6 shrink-0 text-indigo-600">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z" />
                                    </svg>
                                    Payments
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="lg:pl-64 h-full flex flex-col bg-gray-50 overflow-y-auto">
        <div
            class="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-xs sm:gap-x-6 sm:px-6 lg:px-8">
            <button type="button" command="show-modal" commandfor="sidebar"
                class="-m-2.5 p-2.5 text-gray-700 hover:text-gray-900 lg:hidden">
                <span class="sr-only">Open sidebar</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
            <div class="flex flex-1 gap-x-4 self-stretch lg:gap-x-6 items-center">
                <h2 class="text-lg font-semibold text-gray-900">Mega Blessing Chapel International</h2>
            </div>
        </div>

        <main class="py-10">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 fade-in">

                <form id="paymentForm">
                    <div class="space-y-12">

                        <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3">
                            <div>
                                <h2 class="text-base/7 font-semibold text-gray-900">Give Online</h2>
                                <p class="mt-1 text-sm/6 text-gray-600">Support the ministry with your tithes,
                                    offerings, and seeds.</p>
                            </div>

                            <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2">
                                <div class="col-span-full">
                                    <label for="email-address" class="block text-sm/6 font-medium text-gray-900">Email
                                        Address</label>
                                    <div class="mt-2">
                                        <input type="email" id="email-address" required placeholder="example@email.com"
                                            class="block w-full rounded-lg border-0 bg-white/50 px-3.5 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-indigo-600 transition-all duration-200 sm:text-sm/6" />
                                    </div>
                                </div>
                                <div class="col-span-full">
                                    <label class="block text-sm/6 font-medium text-gray-900">Phone Number</label>
                                    <div class="mt-2 flex gap-2">
                                        <input id="country_code" type="text" value="+233"
                                            class="block w-20 rounded-lg border-0 bg-gray-50 px-3.5 py-2 text-center text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm/6" />
                                        <input id="phone_number" type="tel" required
                                            class="block w-full rounded-lg border-0 bg-white/50 px-3.5 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-indigo-600 transition-all duration-200 sm:text-sm/6" />
                                    </div>
                                </div>

                                <div class="col-span-full">
                                    <label for="type" class="block text-sm/6 font-medium text-gray-900">Giving
                                        Type</label>
                                    <div class="mt-2 text-center">
                                        <div class="relative">
                                            <select id="type" required
                                                class="block w-full appearance-none rounded-lg border-0 bg-white/50 py-2.5 pr-10 pl-3.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-indigo-600 transition-all duration-200 sm:text-sm/6 cursor-pointer">
                                                <option value="offering">Offering</option>
                                                <option value="welfare_dues">Welfare Dues</option>
                                                <option value="youth_dues">Youth Dues</option>
                                                <option value="thanksgiving">Thanksgiving</option>
                                                <option value="support">Support</option>
                                            </select>
                                            <div
                                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"
                                                    aria-hidden="true">
                                                    <path fill-rule="evenodd"
                                                        d="M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.2a.75.75 0 011.06.04l2.7 2.908 2.7-2.908a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0l-3.25-3.5a.75.75 0 01.04-1.06z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-span-full">
                                    <label for="amount" class="block text-sm/6 font-medium text-gray-900">Amount
                                        (GHS)</label>
                                    <div class="mt-2">
                                        <div
                                            class="flex items-center rounded-lg bg-white/50 pl-3 outline-1 -outline-offset-1 outline-gray-300 focus-within:outline-2 focus-within:-outline-offset-2 focus-within:outline-indigo-600 ring-1 ring-inset ring-gray-300 transition-all duration-200">
                                            <div class="shrink-0 text-base text-gray-500 select-none sm:text-sm/6">GHS
                                            </div>
                                            <input type="number" id="amount" required placeholder="0.00"
                                                class="block min-w-0 grow bg-transparent py-2 pr-3 pl-1 text-base text-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6" />
                                        </div>
                                    </div>
                                </div>

                                <div class="col-span-full">
                                    <label for="full_name" class="block text-sm/6 font-medium text-gray-900">Full
                                        Name</label>
                                    <div class="mt-2">
                                        <input type="text" id="full_name" required placeholder="John Doe"
                                            class="block w-full rounded-lg border-0 bg-white/50 px-3.5 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-indigo-600 transition-all duration-200 sm:text-sm/6" />
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>

                    <div class="mt-6 flex items-center justify-end gap-x-6">
                        <button type="submit" id="pay-btn"
                            class="flex items-center justify-center rounded-lg bg-indigo-600 px-5 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition-all duration-200 hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span id="pay-text">Pay Now</span>
                            <svg id="pay-loader" class="hidden animate-spin h-5 w-5 text-white"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </form>

            </div>
        </main>
    </div>

    <!-- Custom Modal -->
    <div id="modal"
        class="modal-overlay fixed inset-0 z-[1000] flex items-center justify-center bg-black/50 opacity-0 invisible backdrop-blur-sm">
        <div
            class="modal-content w-[90%] max-w-[400px] transform scale-90 rounded-2xl bg-white p-8 shadow-2xl transition-transform duration-300">
            <div class="mb-4 flex items-center gap-4">
                <div id="modal-icon"
                    class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-xl font-bold"></div>
                <h3 id="modal-title" class="m-0 text-xl font-bold text-gray-900"></h3>
            </div>
            <p id="modal-message" class="mb-6 text-[0.95rem] leading-relaxed text-gray-600"></p>
            <div class="flex justify-end gap-4">
                <button id="modal-close-btn"
                    class="cursor-pointer rounded-lg bg-indigo-600 px-6 py-2.5 text-sm font-semibold text-white transition-transform hover:-translate-y-px hover:bg-indigo-700 hover:shadow-lg"
                    onclick="closeModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Script to handle Paystack -->
    <script>
        const paymentForm = document.getElementById('paymentForm');

        // REPLACE THIS WITH YOUR PUBLIC KEY AVAILABLE IN YOUR PAYSTACK DASHBOARD
        const PAYSTACK_PUBLIC_KEY = 'pk_test_ee994c4c0c2ea9735b93fd1337899aee6ca57f8b';



        const typeSelect = document.getElementById('type');
        const amountInput = document.getElementById('amount');

        typeSelect.addEventListener('change', function () {
            if (this.value === 'welfare_dues') {
                amountInput.value = '50';
                amountInput.disabled = true;
            } else if (this.value === 'youth_dues') {
                amountInput.value = '10';
                amountInput.disabled = true;
            } else {
                amountInput.value = '';
                amountInput.disabled = false;
            }
        });

        paymentForm.addEventListener("submit", payWithPaystack, false);

        function showModal(type, title, message) {
            const modal = document.getElementById("modal");
            const icon = document.getElementById("modal-icon");
            const titleEl = document.getElementById("modal-title");
            const messageEl = document.getElementById("modal-message");

            // Reset classes
            icon.className = `flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-xl font-bold`;

            if (type === "success") {
                icon.classList.add("bg-green-100", "text-green-600");
                icon.textContent = "✓";
            } else if (type === "error") {
                icon.classList.add("bg-red-100", "text-red-600");
                icon.textContent = "✕";
            } else {
                icon.classList.add("bg-blue-100", "text-blue-600");
                icon.textContent = "ℹ";
            }

            titleEl.textContent = title;
            messageEl.textContent = message;
            modal.classList.add("active");
        }

        const payBtn = document.getElementById('pay-btn');
        const payText = document.getElementById('pay-text');
        const payLoader = document.getElementById('pay-loader');

        function toggleLoader(isLoading) {
            if (isLoading) {
                payBtn.disabled = true;
                payText.classList.add('hidden');
                payLoader.classList.remove('hidden');
            } else {
                payBtn.disabled = false;
                payText.classList.remove('hidden');
                payLoader.classList.add('hidden');
            }
        }

        function closeModal() {
            const modal = document.getElementById("modal");
            modal.classList.remove("active");
            // Check if success (we can use a flag or check icon class, but simple reload on close for success is ok if we set a flag)
            if (window.paymentSuccess) {
                location.reload();
            }
        }

        function payWithPaystack(e) {
            e.preventDefault();

            const email = document.getElementById("email-address").value;
            const amount = document.getElementById("amount").value;
            const type = document.getElementById("type").value;
            const fullName = document.getElementById("full_name").value;
            const countryCode = document.getElementById("country_code").value;
            const phoneNumber = document.getElementById("phone_number").value;

            const fullPhoneNumber = countryCode + phoneNumber;

            toggleLoader(true);

            const handler = PaystackPop.setup({
                key: PAYSTACK_PUBLIC_KEY,
                email: email,
                amount: amount * 100, // Paystack expects amount in kobo
                currency: 'GHS',
                metadata: {
                    custom_fields: [
                        { display_name: "Giving Type", variable_name: "giving_type", value: type },
                        { display_name: "Full Name", variable_name: "full_name", value: fullName },
                        { display_name: "Phone Number", variable_name: "phone_number", value: fullPhoneNumber }
                    ]
                },
                callback: function (response) {
                    // Payment successful, send data to backend
                    const payload = {
                        amount: amount,
                        reference: response.reference,
                        paymentType: type,
                        paymentStatus: "success",
                        phoneNumber: fullPhoneNumber,
                        fullName: fullName,
                        email: email,
                        intent: "Online Giving"
                    };

                    // Use the backend proxy endpoint
                    const BACKEND_URL = 'http://localhost:3002/api/pay';

                    fetch(BACKEND_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    })
                        .then(res => {
                            if (res.ok) {
                                window.paymentSuccess = true;
                                showModal("success", "Payment Successful", "Thank you! Your payment has been recorded. Refreshing...");
                                paymentForm.reset();
                                setTimeout(() => location.reload(), 2000);
                            } else {
                                showModal("success", "Payment Successful", "Payment processed, but we couldn't record it in our system. Please check with an admin if needed.");
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            showModal("success", "Payment Successful", "Payment processed. Thank you!");
                        })
                        .finally(() => {
                            toggleLoader(false);
                        });
                },
                onClose: function () {
                    toggleLoader(false);
                    showModal("info", "Cancelled", "Transaction was not completed.");
                }
            });

            handler.openIframe();
        }
    </script>
</body>

</html>