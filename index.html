<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Smart Arena – Extra Classes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://js.paystack.co/v1/inline.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "JetBrains Mono", monospace;
        color: #e2e8f0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 1.5rem;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        z-index: -2;
        pointer-events: none;
      }

      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: -1;
        pointer-events: none;
        background:
          radial-gradient(
            circle at top left,
            rgba(249, 115, 22, 0.2) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at bottom right,
            rgba(168, 85, 247, 0.2) 0%,
            transparent 50%
          );
        filter: blur(100px);
      }

      .container {
        width: 100%;
        max-width: 28rem;
        position: relative;
        z-index: 1;
      }

      .card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(64px);
        -webkit-backdrop-filter: blur(64px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 2rem 2.5rem;
        border-radius: 1.5rem;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
        transition: all 0.3s ease;
      }

      .header {
        text-align: center;
        margin-bottom: 2rem;
      }

      h2 {
        font-size: 1.875rem;
        font-weight: 700;
        letter-spacing: -0.02em;
        color: #f2f2f2;
        margin-bottom: 0.75rem;
      }

      .description {
        font-size: 0.875rem;
        color: #a1a5b4;
        line-height: 1.6;
        margin: 0;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #f2f2f2;
        margin-bottom: 0.5rem;
      }

      input,
      select {
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        border: 1px solid rgba(113, 128, 150, 0.3);
        background: rgba(15, 23, 42, 0.6);
        color: #f2f2f2;
        font-size: 0.875rem;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23f2f2f2' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        padding-right: 2.5rem;
      }

      select option {
        background: #1e293b;
        color: #f2f2f2;
      }

      select option:checked {
        background: linear-gradient(#ea580c, #a855f7);
        color: #f2f2f2;
      }

      input::placeholder,
      select::placeholder {
        color: rgba(226, 232, 240, 0.5);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #f97316;
        background: rgba(15, 23, 42, 0.8);
        box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
      }

      button {
        width: 100%;
        padding: 0.875rem 1rem;
        margin-top: 0.5rem;
        border-radius: 0.5rem;
        border: none;
        background: linear-gradient(135deg, #ea580c 0%, #a855f7 100%);
        color: #fff;
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(234, 88, 12, 0.3);
      }

      button:hover {
        background: linear-gradient(135deg, #dc2626 0%, #9333ea 100%);
        box-shadow: 0 8px 20px rgba(234, 88, 12, 0.4);
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      @media (max-width: 640px) {
        .card {
          padding: 1.5rem 1.25rem;
        }

        h2 {
          font-size: 1.5rem;
        }

        input,
        select {
          padding: 0.7rem 0.875rem;
        }
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition:
          opacity 0.3s ease,
          visibility 0.3s ease;
        backdrop-filter: blur(4px);
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
        transform: scale(0.9);
        transition: transform 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .modal-overlay.active .modal-content {
        transform: scale(1);
      }

      .modal-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .modal-icon {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        flex-shrink: 0;
      }

      .modal-icon.success {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
      }

      .modal-icon.error {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }

      .modal-icon.info {
        background: rgba(59, 130, 246, 0.2);
        color: #3b82f6;
      }

      .modal-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #f2f2f2;
        margin: 0;
      }

      .modal-message {
        font-size: 0.95rem;
        color: #cbd5e1;
        line-height: 1.6;
        margin-bottom: 1.5rem;
      }

      .modal-footer {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
      }

      .modal-btn {
        padding: 0.625rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .modal-btn-primary {
        background: linear-gradient(135deg, #ea580c 0%, #a855f7 100%);
        color: white;
      }

      .modal-btn-primary:hover {
        background: linear-gradient(135deg, #dc2626 0%, #9333ea 100%);
        transform: translateY(-1px);
      }

      .modal-btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #cbd5e1;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .modal-btn-secondary:hover {
        background: rgba(255, 255, 255, 0.15);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="header">
          <h2>Smart Arena</h2>
          <p class="description">
            Join Smart Arena to access expertly-crafted extra classes and
            elevate your academic performance. Register now to unlock premium
            learning resources tailored for your success.
          </p>
        </div>

        <div class="form-group">
          <input id="full_name" placeholder="Full Name" required />
          <input id="email" type="email" placeholder="Email" required />
          <input id="phone_number" placeholder="Phone Number" required />
          <input id="level" placeholder="Level (e.g. 200)" />
          <input id="program" placeholder="Program" />

          <select id="course" required onchange="updateClassType()">
            <option value="">Select Course</option>
            <option value="PHYS 143">PHYS 143</option>
            <option value="MATH 121">MATH 121</option>
            <option value="DCIT 101">DCIT 101</option>
          </select>

          <select id="class_type" style="display: none">
            <option value="online">Online</option>
            <option value="in-person">In Person</option>
          </select>

          <button onclick="pay()">Pay GHS 15 & Register</button>
        </div>
      </div>
    </div>

    <div id="modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <div id="modal-icon" class="modal-icon"></div>
          <h3 id="modal-title" class="modal-title"></h3>
        </div>
        <p id="modal-message" class="modal-message"></p>
        <div class="modal-footer">
          <button
            id="modal-close-btn"
            class="modal-btn modal-btn-primary"
            onclick="closeModal()"
          >
            Done
          </button>
        </div>
      </div>
    </div>

    <script>
      const PAYSTACK_KEY = "pk_test_ee994c4c0c2ea9735b93fd1337899aee6ca57f8b";
      const BACKEND_URL = "http://localhost:3000"; // Your backend URL

      const FIXED_AMOUNT = 15; // GHS
      const LOCATION = "PL";

      function showModal(type, title, message) {
        const modal = document.getElementById("modal");
        const icon = document.getElementById("modal-icon");
        const titleEl = document.getElementById("modal-title");
        const messageEl = document.getElementById("modal-message");

        icon.className = `modal-icon ${type}`;

        if (type === "success") {
          icon.textContent = "✓";
        } else if (type === "error") {
          icon.textContent = "✕";
        } else {
          icon.textContent = "ℹ";
        }

        titleEl.textContent = title;
        messageEl.textContent = message;
        modal.classList.add("active");
      }

      function closeModal() {
        const modal = document.getElementById("modal");
        modal.classList.remove("active");
      }

      function updateClassType() {
        const course = document.getElementById("course").value;
        const classType = document.getElementById("class_type");

        if (course.includes("PHYS") || course.includes("MATH")) {
          classType.value = "in-person";
        } else if (course.includes("DCIT") || course.includes("CODING")) {
          classType.value = "online";
        } else {
          classType.value = "online";
        }
      }

      async function submitToBackend(data, paymentStatus, reference = null) {
        try {
          const response = await fetch(`${BACKEND_URL}/api/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              ...data,
              payment_status: paymentStatus,
              reference: reference,
            }),
          });

          if (!response.ok) throw new Error("Backend request failed");
          return await response.json();
        } catch (error) {
          console.error("Error:", error);
          throw error;
        }
      }

      function pay() {
        const data = {
          full_name: full_name.value,
          email: email.value,
          phone_number: phone_number.value,
          level: level.value,
          program: program.value,
          course: course.value,
          amount: FIXED_AMOUNT,
          class_type: class_type.value,
          location: LOCATION,
        };

        console.log(data);

        if (!data.email || !data.course || !data.full_name) {
          showModal(
            "error",
            "Missing Information",
            "Please complete required fields",
          );
          return;
        }

        PaystackPop.setup({
          key: PAYSTACK_KEY,
          email: data.email,
          amount: FIXED_AMOUNT * 100,
          currency: "GHS",
          callback: function (response) {
            submitToBackend(data, "success", response.reference)
              .then(() => {
                showModal(
                  "success",
                  "Payment Successful",
                  "Check your email for further instructions. Contact admin on jwlarbi15@gmail.com if no email is received.",
                );
                setTimeout(() => location.reload(), 2000);
              })
              .catch(() => {
                showModal(
                  "error",
                  "Server Error",
                  "Payment recorded but notification failed. Please contact support on jwlarbi15@gmail.com.",
                );
              });
          },
          onClose: function () {
            submitToBackend(data, "failed").catch((error) => {
              console.error("Error logging failed payment:", error);
            });
          },
        }).openIframe();
      }
    </script>
  </body>
</html>
